require([
    'jquery',
    'splunkjs/mvc',
    'splunkjs/mvc/simplexml/ready!'
], function ($, mvc) { 

    var personSVGSimple = function(id, percent, color) {
        return /*svg*/`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 125 133">
                        <defs>
                            <linearGradient id="${id}_gradient" x1="0" y1="1" x2="0" y2="0">
                                <stop id="${id}_stop1" offset="${percent}" stop-color="${color}"/>
                                <stop id="${id}_stop2" offset="${percent}" stop-color="rgba(255, 255, 255, 0.3)"/>
                            </linearGradient>
                        </defs>
                        <g style="fill:url(#${id}_gradient);fill-rule:nonzero;">
                            <path d="M62.096,8.586C56.889,8.586 52.673,12.805 52.673,18.012C52.674,23.214 56.89,27.435 62.096,27.435C67.298,27.435 71.518,23.214 71.518,18.012C71.518,12.804 67.298,8.586 62.096,8.586ZM51.687,29.853C45.015,29.853 39.556,35.26 39.556,41.923L39.556,71.152C39.556,73.427 41.347,75.275 43.626,75.275C45.906,75.275 47.753,73.429 47.753,71.152L47.753,44.798L49.855,44.798C49.855,44.798 49.903,113.607 49.903,118.127C49.903,121.177 52.381,123.657 55.435,123.657C58.487,123.657 60.96,121.177 60.96,118.127L60.96,75.547L63.229,75.547L63.229,118.127C63.229,121.177 65.702,123.657 68.76,123.657C71.814,123.657 74.309,121.177 74.309,118.127L74.309,44.798L76.436,44.798L76.436,71.152C76.436,73.427 78.286,75.275 80.562,75.275C82.842,75.275 84.635,73.429 84.635,71.152L84.635,41.923C84.635,35.26 79.172,29.853 72.506,29.853L51.687,29.853Z"/>
                            <path d="M51.687,29.853C45.015,29.853 39.556,35.26 39.556,41.923L39.556,71.152C39.556,73.427 41.347,75.275 43.626,75.275C45.906,75.275 47.753,73.429 47.753,71.152L47.753,44.798L49.855,44.798C49.855,44.798 49.903,113.607 49.903,118.127C49.903,121.177 52.381,123.657 55.435,123.657C58.487,123.657 60.96,121.177 60.96,118.127L60.96,75.547L63.229,75.547L63.229,118.127C63.229,121.177 65.702,123.657 68.76,123.657C71.814,123.657 74.309,121.177 74.309,118.127L74.309,44.798L76.436,44.798L76.436,71.152C76.436,73.427 78.286,75.275 80.562,75.275C82.842,75.275 84.635,73.429 84.635,71.152L84.635,41.923C84.635,35.26 79.172,29.853 72.506,29.853L51.687,29.853ZM51.687,30.853L72.506,30.853C78.621,30.853 83.635,35.811 83.635,41.923C83.635,41.923 83.635,71.152 83.635,71.152C83.635,72.874 82.286,74.275 80.562,74.275C78.838,74.275 77.436,72.876 77.436,71.152C77.436,71.152 77.436,44.798 77.436,44.798C77.436,44.246 76.988,43.798 76.436,43.798L74.309,43.798C73.757,43.798 73.309,44.246 73.309,44.798L73.309,118.127C73.309,120.627 71.263,122.657 68.76,122.657C66.255,122.657 64.229,120.626 64.229,118.127C64.229,118.127 64.229,75.547 64.229,75.547C64.229,74.995 63.782,74.547 63.229,74.547L60.96,74.547C60.407,74.547 59.96,74.995 59.96,75.547L59.96,118.127C59.96,120.625 57.934,122.657 55.435,122.657C52.933,122.657 50.903,120.626 50.903,118.127C50.903,113.607 50.855,44.797 50.855,44.797C50.854,44.245 50.407,43.798 49.855,43.798L47.753,43.798C47.201,43.798 46.753,44.246 46.753,44.798L46.753,71.152C46.753,72.877 45.353,74.275 43.626,74.275C41.903,74.275 40.556,72.872 40.556,71.152C40.556,71.152 40.556,41.923 40.556,41.923C40.556,35.811 45.566,30.853 51.687,30.853ZM62.096,8.586C67.298,8.586 71.518,12.804 71.518,18.012C71.518,23.214 67.298,27.435 62.096,27.435C56.89,27.435 52.674,23.214 52.673,18.012C52.673,12.805 56.889,8.586 62.096,8.586ZM62.096,9.586C66.746,9.586 70.518,13.356 70.518,18.012C70.518,22.662 66.746,26.435 62.096,26.435C57.442,26.435 53.674,22.662 53.673,18.011C53.673,13.357 57.441,9.586 62.096,9.586Z" style="stroke:${color}"/>
                        </g>
                    </svg>`
    }

    var personSVGAdvanced = function(id, data) {
        console.log(getGradientTemplate(id, data));
        return /*svg*/`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 125 133">
                        <defs>
                            <linearGradient id="${id}_gradient" x1="0" y1="1" x2="0" y2="0">
                                ${getGradientTemplate(id, data)}
                            </linearGradient>
                        </defs>
                        <g style="fill:url(#${id}_gradient);fill-rule:nonzero;">
                            <path d="M62.096,8.586C56.889,8.586 52.673,12.805 52.673,18.012C52.674,23.214 56.89,27.435 62.096,27.435C67.298,27.435 71.518,23.214 71.518,18.012C71.518,12.804 67.298,8.586 62.096,8.586ZM51.687,29.853C45.015,29.853 39.556,35.26 39.556,41.923L39.556,71.152C39.556,73.427 41.347,75.275 43.626,75.275C45.906,75.275 47.753,73.429 47.753,71.152L47.753,44.798L49.855,44.798C49.855,44.798 49.903,113.607 49.903,118.127C49.903,121.177 52.381,123.657 55.435,123.657C58.487,123.657 60.96,121.177 60.96,118.127L60.96,75.547L63.229,75.547L63.229,118.127C63.229,121.177 65.702,123.657 68.76,123.657C71.814,123.657 74.309,121.177 74.309,118.127L74.309,44.798L76.436,44.798L76.436,71.152C76.436,73.427 78.286,75.275 80.562,75.275C82.842,75.275 84.635,73.429 84.635,71.152L84.635,41.923C84.635,35.26 79.172,29.853 72.506,29.853L51.687,29.853Z"/>
                            <path d="M51.687,29.853C45.015,29.853 39.556,35.26 39.556,41.923L39.556,71.152C39.556,73.427 41.347,75.275 43.626,75.275C45.906,75.275 47.753,73.429 47.753,71.152L47.753,44.798L49.855,44.798C49.855,44.798 49.903,113.607 49.903,118.127C49.903,121.177 52.381,123.657 55.435,123.657C58.487,123.657 60.96,121.177 60.96,118.127L60.96,75.547L63.229,75.547L63.229,118.127C63.229,121.177 65.702,123.657 68.76,123.657C71.814,123.657 74.309,121.177 74.309,118.127L74.309,44.798L76.436,44.798L76.436,71.152C76.436,73.427 78.286,75.275 80.562,75.275C82.842,75.275 84.635,73.429 84.635,71.152L84.635,41.923C84.635,35.26 79.172,29.853 72.506,29.853L51.687,29.853ZM51.687,30.853L72.506,30.853C78.621,30.853 83.635,35.811 83.635,41.923C83.635,41.923 83.635,71.152 83.635,71.152C83.635,72.874 82.286,74.275 80.562,74.275C78.838,74.275 77.436,72.876 77.436,71.152C77.436,71.152 77.436,44.798 77.436,44.798C77.436,44.246 76.988,43.798 76.436,43.798L74.309,43.798C73.757,43.798 73.309,44.246 73.309,44.798L73.309,118.127C73.309,120.627 71.263,122.657 68.76,122.657C66.255,122.657 64.229,120.626 64.229,118.127C64.229,118.127 64.229,75.547 64.229,75.547C64.229,74.995 63.782,74.547 63.229,74.547L60.96,74.547C60.407,74.547 59.96,74.995 59.96,75.547L59.96,118.127C59.96,120.625 57.934,122.657 55.435,122.657C52.933,122.657 50.903,120.626 50.903,118.127C50.903,113.607 50.855,44.797 50.855,44.797C50.854,44.245 50.407,43.798 49.855,43.798L47.753,43.798C47.201,43.798 46.753,44.246 46.753,44.798L46.753,71.152C46.753,72.877 45.353,74.275 43.626,74.275C41.903,74.275 40.556,72.872 40.556,71.152C40.556,71.152 40.556,41.923 40.556,41.923C40.556,35.811 45.566,30.853 51.687,30.853ZM62.096,8.586C67.298,8.586 71.518,12.804 71.518,18.012C71.518,23.214 67.298,27.435 62.096,27.435C56.89,27.435 52.674,23.214 52.673,18.012C52.673,12.805 56.889,8.586 62.096,8.586ZM62.096,9.586C66.746,9.586 70.518,13.356 70.518,18.012C70.518,22.662 66.746,26.435 62.096,26.435C57.442,26.435 53.674,22.662 53.673,18.011C53.673,13.357 57.441,9.586 62.096,9.586Z" style="stroke:#818D99"/>
                        </g>
                    </svg>`
    }

    var getGradientTemplate = function(id, data) {
                var actPercent = 0;
                var template = data.map(function(item, i) {
                    var templateString = "";

                    if(i > 0) {
                        templateString +=`<stop id="${id}_stop${i-1}" offset="${actPercent}" stop-color="${item.color}"/>`;
                    }
                    actPercent += parseFloat(item.percent);

                    templateString +=`<stop id="${id}_start${i}" offset="${actPercent}" stop-color="${item.color}"/>`;

                    if(i == data.length-1) {
                        templateString +=`<stop id="${id}_stop${i}"ss offset="${actPercent}" stop-color="#fff"/>`;
                    }

                    return templateString;

                }).join('');

                return template;
    }


    var simpleSearch = mvc.Components.getInstance('jsSimpleExampleSearch');
    var simpleResults = simpleSearch.data("results", {
        output_mode: 'json_rows'
    });

    simpleResults.on('data', function() {
        console.log(simpleResults.collection().toJSON());
        var data = simpleResults.collection().toJSON();
        $('#svgInJSSimple').empty();
        $('#svgInJSSimple').append(personSVGSimple("simpleExample", data[0].percent, data[0].color));
    });




    var advancedSearch = mvc.Components.getInstance('jsAdvancedExampleSearch');

    var advancedResults = advancedSearch.data("results", {
        output_mode: 'json_rows'
    });

    advancedResults.on('data', function() {
        console.log(advancedResults.collection().toJSON());

        var data = advancedResults.collection().toJSON();
        $('#svgInJSAdvanced').empty();
        $('#svgInJSAdvanced').append(personSVGAdvanced("svgInJSAdvanced", data));
    });


});